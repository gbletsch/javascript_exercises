<!doctype html>
<html>
  <head>
    <title>A Solid Game Loop</title>
    <link rel='stylesheet' href='styles.css'>
    <script src='drawing.js'></script>
  </head>
  <body>
    <h1>A Solid Game Loop</h1>
    <canvas id='asteroids' width='400' height='400'></canvas>
    <script>
      var canvas = document.getElementById('asteroids');
      var context = canvas.getContext('2d');

      var asteroid = {
        // asteroid shape
        segments: 24,
        shape: [],
        radius: 50,
        noise: .5,

        // asteroid state
        x: canvas.width * Math.random(),
        y: canvas.height * Math.random(),
        angle: 0,

        // asteroid movement
        x_speed: canvas.width * (Math.random() - .5),
        y_speed: canvas.height * (Math.random() - .5),
        rotation_speed: 2 * Math.PI * (Math.random() - .5),
      };

      for(var i = 0; i < asteroid.segments; i++){
        asteroid.shape.push(Math.random() - .5);
      }

      function draw(ctx, guide){
        if(guide){
          draw_grid(ctx);
        }
        ctx.save();
        ctx.translate(asteroid.x, asteroid.y);
        ctx.rotate(asteroid.angle);
        draw_asteroid(
          ctx, asteroid.radius, asteroid.shape, {
            guide: guide,
            noise: asteroid.noise
        });
        ctx.restore();
      }

      function update(elapsed){
        if(asteroid.x - asteroid.radius + elapsed * asteroid.x_speed > canvas.width)
        {asteroid.x = - asteroid.radius;}
        if(asteroid.x + asteroid.radius + elapsed * asteroid.x_speed < 0)
        {asteroid.x = canvas.width + asteroid.radius;}
        if(asteroid.y - asteroid.radius + elapsed * asteroid.y_speed > canvas.height)
        {asteroid.y = - asteroid.radius;}
        if(asteroid.y + asteroid.radius + elapsed * asteroid.y_speed < 0)
        {asteroid.y = canvas.height + asteroid.radius}
        asteroid.x += elapsed * asteroid.x_speed;
        asteroid.y += elapsed * asteroid.y_speed;
        asteroid.angle = (asteroid.angle + elapsed * asteroid.rotation_speed) % (2 * Math.PI);
      }

      var previous, elapsed;
      function frame(timestamp){
        context.clearRect(0, 0, canvas.width, canvas.height);
        if (!previous) previous = timestamp;
        elapsed = timestamp - previous;
        update(elapsed / 1000);
        draw(context, true);
        previous = timestamp;
        window.requestAnimationFrame(frame);
      }
      window.requestAnimationFrame(frame);
    </script>
  </body>
</html>
